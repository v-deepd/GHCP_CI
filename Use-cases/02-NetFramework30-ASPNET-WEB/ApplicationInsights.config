<?xml version="1.0" encoding="utf-8"?>
<!--
Azure Migration: Application Insights configuration for monitoring and diagnostics.
The instrumentation key will be set via Azure App Service Application Settings.
This enables real-time monitoring, performance tracking, and error logging.
-->
<ApplicationInsights xmlns="http://schemas.microsoft.com/ApplicationInsights/2013/Settings">
  <!-- 
  Instrumentation key - set via App Settings in Azure Portal
  Format: @Microsoft.KeyVault(SecretUri=https://your-vault.vault.azure.net/secrets/AppInsightsKey/)
  Or directly in App Settings: APPINSIGHTS_INSTRUMENTATIONKEY
  -->
  <InstrumentationKey></InstrumentationKey>
  
  <!-- Enable adaptive sampling to control data volume and costs -->
  <TelemetryProcessors>
    <Add Type="Microsoft.ApplicationInsights.WindowsServer.TelemetryChannel.AdaptiveSamplingTelemetryProcessor, Microsoft.ApplicationInsights.WindowsServer.TelemetryChannel">
      <MaxTelemetryItemsPerSecond>5</MaxTelemetryItemsPerSecond>
      <IncludedTypes>Event;Exception;PageView;Request;Trace</IncludedTypes>
    </Add>
  </TelemetryProcessors>
  
  <!-- Telemetry Initializers add context to all telemetry -->
  <TelemetryInitializers>
    <Add Type="Microsoft.ApplicationInsights.Web.WebTestTelemetryInitializer, Microsoft.ApplicationInsights.Web" />
    <Add Type="Microsoft.ApplicationInsights.Web.SyntheticUserAgentTelemetryInitializer, Microsoft.ApplicationInsights.Web">
      <Filters>
        <Add Pattern="^(AlwaysOn|Azure Bot Service|Azure Web App|AppInsights)" SourceName="UserAgent" />
      </Filters>
    </Add>
    <Add Type="Microsoft.ApplicationInsights.Web.ClientIpHeaderTelemetryInitializer, Microsoft.ApplicationInsights.Web" />
    <Add Type="Microsoft.ApplicationInsights.Web.OperationNameTelemetryInitializer, Microsoft.ApplicationInsights.Web" />
    <Add Type="Microsoft.ApplicationInsights.Web.OperationCorrelationTelemetryInitializer, Microsoft.ApplicationInsights.Web" />
    <Add Type="Microsoft.ApplicationInsights.Web.UserTelemetryInitializer, Microsoft.ApplicationInsights.Web" />
    <Add Type="Microsoft.ApplicationInsights.Web.AuthenticatedUserIdTelemetryInitializer, Microsoft.ApplicationInsights.Web" />
    <Add Type="Microsoft.ApplicationInsights.Web.AccountIdTelemetryInitializer, Microsoft.ApplicationInsights.Web" />
    <Add Type="Microsoft.ApplicationInsights.Web.SessionTelemetryInitializer, Microsoft.ApplicationInsights.Web" />
  </TelemetryInitializers>
  
  <!-- Telemetry Modules collect specific types of telemetry -->
  <TelemetryModules>
    <!-- Request tracking -->
    <Add Type="Microsoft.ApplicationInsights.Web.RequestTrackingTelemetryModule, Microsoft.ApplicationInsights.Web">
      <Handlers>
        <Add>System.Web.Handlers.TransferRequestHandler</Add>
        <Add>Microsoft.VisualStudio.Web.PageInspector.Runtime.Tracing.RequestDataHttpHandler</Add>
        <Add>System.Web.StaticFileHandler</Add>
        <Add>System.Web.Handlers.AssemblyResourceLoader</Add>
        <Add>System.Web.Optimization.BundleHandler</Add>
        <Add>System.Web.Script.Services.ScriptHandlerFactory</Add>
        <Add>System.Web.Handlers.TraceHandler</Add>
        <Add>System.Web.Services.Discovery.DiscoveryRequestHandler</Add>
        <Add>System.Web.HttpDebugHandler</Add>
      </Handlers>
    </Add>
    
    <!-- Exception tracking -->
    <Add Type="Microsoft.ApplicationInsights.Web.ExceptionTrackingTelemetryModule, Microsoft.ApplicationInsights.Web" />
    
    <!-- Dependency tracking (SQL, HTTP calls) -->
    <Add Type="Microsoft.ApplicationInsights.Web.DependencyTrackingTelemetryModule, Microsoft.ApplicationInsights.Web" />
    
    <!-- Performance counters -->
    <Add Type="Microsoft.ApplicationInsights.Extensibility.PerfCounterCollector.PerformanceCollectorModule, Microsoft.ApplicationInsights.Extensibility.PerfCounterCollector">
      <Counters>
        <Add PerformanceCounter="\Process(??APP_WIN32_PROC??)\% Processor Time" ReportAs="CPU" />
        <Add PerformanceCounter="\Process(??APP_WIN32_PROC??)\Private Bytes" ReportAs="Memory" />
        <Add PerformanceCounter="\ASP.NET Applications(??APP_W3SVC_PROC??)\Requests/Sec" ReportAs="Requests/Sec" />
        <Add PerformanceCounter="\ASP.NET Applications(??APP_W3SVC_PROC??)\Request Execution Time" ReportAs="Request Execution Time" />
      </Counters>
    </Add>
    
    <!-- Azure Web App diagnostics -->
    <Add Type="Microsoft.ApplicationInsights.Extensibility.Implementation.Tracing.DiagnosticsTelemetryModule, Microsoft.ApplicationInsights" />
  </TelemetryModules>
  
  <!-- Telemetry Channel for data transmission -->
  <TelemetryChannel Type="Microsoft.ApplicationInsights.WindowsServer.TelemetryChannel.ServerTelemetryChannel, Microsoft.ApplicationInsights.WindowsServer.TelemetryChannel" />
  
</ApplicationInsights>